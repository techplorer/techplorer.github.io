---
layout:   post
title:   "浮点数除零"
subtitle:  ""
date:    2022-08-13 13:00:00
author:   "zhouhaijun"
catalog: false
header-style: text
tags:
 - 计算机原理
---



#### 背景交代

前几天在工作上遇到一个浮点数除零的问题，暴露了自己知识点的不足，这里整理一下吧。

浮点数除0会不会有异常呢？要回答这个问题，我们需要拆分成几个知识点。

#### 浮点数在计算机怎么存储
有关浮点数在计算机的存储，IEEE754标准对此做了说明：

![](/img/in-post/zhouhaijun-pic/2022/float-ieee754.png)

目前常用的两种表示方法：单精度浮点数、双精度浮点数：

- 单精度浮点数，一共是32位，其中符号位占1位，指数部分占8位，尾数部分占23位；
- 双精度浮点数，一共是64位，其中符号位占1位，指数部分占11位，尾数部分占52位；

以单精度为例来说：

- sign位为0表示正数，为1表示负数；
- 指数部分占8位，表示的范围是0～255，但是因为考虑到负数，所以能表达的范围就是-126～127，存储的时候127+指数；
- 尾数部分占23位；

这里要提一下科学记数法，因为IEEE754里对浮点数存储的的规定是基于科学记数法的。

先来看一下10进制的浮点数的科学计数法：

3498523 = 3.498523×10^6

−0.0432=−4.32×10^(−2)

那么2进制下的浮点数该怎么表示呢？其实也是一样的道理，分别将整数和小数部分转为2进制即可，原理很简单，整数部分一直除2一直到整数为0截止，小数部分一直乘2一直到小数为0截止(乘不尽的保留指定位数)。

举个例子来说，125.125

其中整数部分，125=111101

小数部分，0.125=0.001

所以125.125=111101.001=1.11101001x2^5



最后，来看一下125.125按照单精度的存储方式，它的实际存储数据是：

| 符号位(1位) | 指数部分(8位) | 小数部分(23位)          |
| ----------- | ------------- | ----------------------- |
| 0           | 01111010      | 11101001000000000000000 |

因为是正数，符号位为0；指数是5，5+127=132=1111010；小数部分，因为科学记数法的整数一定是大于0的，所以2进制下直接记录小数部分即可，在这里就是11101001



#### 浮点数定义:0/INF/NAN
IEEE754里对0/INF/NAN分别做了定义：

![](/img/in-post/zhouhaijun-pic/2022/float-def-nan-inf.png)

按照IEEE754的描述，有几种特殊情况：

- 指数全为0，小数部分全为0，这里要注意的是，按照IEEE754的标准，会存在一个小的问题，那就是浮点数会有+0和-0的区分；
- 指数全为1，小数部分全为0，符号位为0表示+Inf，正无穷大，符号位为1表示-Inf，即负无穷大；
- 指数全为1，小数部分不全为0，这种表示的是NAN，即非数字，not a number；
  另外，这里需要注意的是，当遇到浮点数除0、负数求平方根的情况下，结果就是NAN。



#### 浮点数除零
整数除0是会引发错误，但是浮点数除0却不是一个错误，为什么IEEE 754里要这么规定呢？这里官方也给出了一个解释：

![](/img/in-post/zhouhaijun-pic/2022/float-divide-by-zero.png)

IEEE  754对浮点数定义的场景较多，不局限于数学运算，还有电子表格、数据库的数据，所以标准里才有了INF/NAN的定义。

最后再来看一下c++里的浮点数除零的几种场景：

```
float c = 0.0 / 0.0;   // nan
float c = 1.0 / 0.0;   // inf
float c = -1.0 / 0.0;  // -inf
```



#### 参考资料

- [IEEE 754标准](http://mathcenter.oxford.emory.edu/site/cs170/ieee754/)

- [why float dividing by zero is not a error?](https://web.archive.org/web/20180112211305/http://grouper.ieee.org/groups/754/faq.html#exceptions)

- [浮点数10进制转2进制工具](https://baseconvert.com/ieee-754-floating-point)
